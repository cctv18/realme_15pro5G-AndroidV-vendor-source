#include <linux/irqreturn.h>
#include <linux/platform_device.h>
#include <linux/module.h>
#include <linux/sched.h>
#include "../../../hbp_core.h"
#include "../../../hbp_spi.h"
#include "../../../utils/debug.h"
#include "tcm/synaptics_touchcom_core_dev.h"
#include "tcm/synaptics_touchcom_func_base.h"
#include "tcm/synaptics_touchcom_func_touch.h"
#include "syna_tcm2_runtime.h"

#define REPORT_TYPES (256)
#define EFP_ENABLE   (1)
#define EFP_DISABLE  (0)

struct syna_tcm {
    struct tcm_dev *tcm_dev;
    struct platform_device *pdev;
    //struct hbp_bus_io *bus_io;
    struct bus_operations *bus_ops;
    unsigned char status_report_code;

    /* Generic touched data generated by tcm core lib */
    struct tcm_touch_data_blob tp_data;
    /* g_extif_mutex is used to protect the access from the userspace application */
    syna_pal_mutex_t extif_mutex;
    struct mutex mutex;

    /* Buffer stored the irq event data */
    struct tcm_buffer event_data;
    /* cdev and sysfs nodes creation */
    struct cdev char_dev;
    dev_t char_dev_num;
    int char_dev_ref_count;
    struct class *device_class;
    struct device *device;
    struct kobject *sysfs_dir;
    /* IOCTL-related variables */
    pid_t proc_pid;
    struct task_struct *proc_task;

    /* flags */
    bool probe_done;
    bool is_attn_redirecting;
    bool char_dev_irq_disabled;
};

int syna_cdev_create_sysfs(struct syna_tcm *ptcm, struct platform_device *pdev);

void syna_cdev_remove_sysfs(struct syna_tcm *ptcm);
